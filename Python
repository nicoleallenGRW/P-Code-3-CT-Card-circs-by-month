# -*- coding: utf-8 -*-
"""
Created on Wed Feb 12 08:59:05 2020

@author: nallen
"""

# -*- coding: utf-8 -*-
"""
Created on Thu Aug  2 14:32:38 2018

@author: nallen
"""

# -*- coding: utf-8 -*-
#!/usr/bin/python2.7
#
# Recreating Web Managment reports for call no circ stats
# 
# Use XlsxWriter to create spreadsheet from SQL Query
# 
#

import psycopg2
import xlsxwriter
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email.mime.text import MIMEText
from email.utils import formatdate
from email import encoders
from datetime import datetime



excelfile =  'PCODE3.xlsx'



#Set variables for email

emailhost = ''
emailport = '25'
emailsubject = 'Circulation Totals from Ct-Card Holders 28 Day'
emailmessage = '''Attached is a spreadsheet with the total number of check-outs and renewals for the month sorted by the patron's pcode3 label.'''
emailfrom = 'nallen'
emailto = ['nallen']
 
try:
    conn = psycopg2.connect("dbname=iii user= host= port= password= sslmode=require")
except psycopg2.Error as e:
    print ("Unable to connect to database: " + str(e))
    
cursor = conn.cursor()
cursor.execute(open("pcode3Days28.sql","r",).read())
rows = cursor.fetchall()
conn.close()


workbook = xlsxwriter.Workbook(excelfile, {'remove_timezone': True})

worksheet = workbook.add_worksheet('Total')

worksheet.set_landscape()
worksheet.hide_gridlines(0)



eformat= workbook.add_format({'text_wrap': True, 'valign': 'top' , 'num_format': 'mm/dd/yy'})
eformatlabel= workbook.add_format({'text_wrap': False, 'valign': 'top', 'bold': True})
eformatlabel1= workbook.add_format({'text_wrap': False, 'valign': 'center', 'bold': True})

worksheet.set_header('pcode3')

#TOTALS 

worksheet.set_column(0,0,44.5)
worksheet.set_column(1,1,10)
worksheet.set_column(2,2,10)
worksheet.set_column(3,3,10)


worksheet.set_header('Circulation')

worksheet.write(0,0,'Library', eformatlabel1)
worksheet.write(0,1,'Circ', eformatlabel1)
worksheet.write(1,0,'Andover', eformatlabel)
worksheet.write(2,0,'Ansonia', eformatlabel)
worksheet.write(3,0,'Ashford', eformatlabel)
worksheet.write(4,0,'Avon', eformatlabel)
worksheet.write(5,0,'Beacon Falls', eformatlabel)
worksheet.write(6,0,'Berlin- Berlin Free Library Association', eformatlabel)
worksheet.write(7,0,'Berlin- Berlin Peck Memorial Association', eformatlabel)
worksheet.write(8,0,'Berlin- East Berlin Peck Library Association', eformatlabel)
worksheet.write(9,0,'Bethany', eformatlabel)
worksheet.write(10,0,'Bethel', eformatlabel)
worksheet.write(11,0,'Bethlehem', eformatlabel)
worksheet.write(12,0,'Bloomfield', eformatlabel)
worksheet.write(13,0,'Bolton', eformatlabel)
worksheet.write(14,0,'Branford - James Blackstone Memorials Library', eformatlabel)
worksheet.write(15,0,'Branford- Willoughby Wallace Memorial Library', eformatlabel)
worksheet.write(16,0,'Bridgeport', eformatlabel)
worksheet.write(17,0,'Bridgewater', eformatlabel)
worksheet.write(18,0,'Bristol', eformatlabel)
worksheet.write(19,0,'Brookfield', eformatlabel)
worksheet.write(20,0,'Brooklyn', eformatlabel)
worksheet.write(21,0,'Burlington', eformatlabel)
worksheet.write(22,0,'Canaan', eformatlabel)
worksheet.write(23,0,'Canterbury', eformatlabel)
worksheet.write(24,0,'Canton', eformatlabel)
worksheet.write(25,0,'Chaplin', eformatlabel)
worksheet.write(26,0,'Chesire', eformatlabel)
worksheet.write(27,0,'Chester', eformatlabel)
worksheet.write(28,0,'Clinton', eformatlabel)
worksheet.write(29,0,'Colchester', eformatlabel)
worksheet.write(30,0,'Columbia', eformatlabel)
worksheet.write(31,0,'Cornwall', eformatlabel)
worksheet.write(32,0,'Coventry', eformatlabel)
worksheet.write(33,0,'Cromwell', eformatlabel)
worksheet.write(34,0,'Danbury- Danbury Public Library', eformatlabel)
worksheet.write(35,0,'Danbury - Long Ridge Library', eformatlabel)
worksheet.write(36,0,'Darien', eformatlabel)
worksheet.write(37,0,'Deep River', eformatlabel)
worksheet.write(38,0,'Derby - Derby Neck Library', eformatlabel)
worksheet.write(39,0,'Derby - Derby Public Library', eformatlabel)
worksheet.write(40,0,'Durham', eformatlabel)
worksheet.write(41,0,'East Granby - East Granby Public Library', eformatlabel)
worksheet.write(42,0,'East Haddam', eformatlabel)
worksheet.write(43,0,'East Hamptom- East Hampton Public Library', eformatlabel)
worksheet.write(44,0,'East Hamptom- East Hampton Public Library', eformatlabel)
worksheet.write(45,0,'East Hartford- East Hartford Public Library', eformatlabel)
worksheet.write(46,0,'East Haven', eformatlabel)
worksheet.write(47,0,'East Lyme', eformatlabel)
worksheet.write(48,0,'East Windsor - Broad Brook Library', eformatlabel)
worksheet.write(49,0,'East Windsor - Library Assn. of Warehouse Point', eformatlabel)
worksheet.write(50,0,'Eastford', eformatlabel)
worksheet.write(51,0,'Easton', eformatlabel)
worksheet.write(52,0,'Ellington', eformatlabel)
worksheet.write(53,0,'Enfield', eformatlabel)
worksheet.write(54,0,'Essex - Essex Public Library', eformatlabel)
worksheet.write(55,0,'Essex - Ivoryton Library Association', eformatlabel)
worksheet.write(56,0,'Fairfield -Fairfield Public Library', eformatlabel)
worksheet.write(57,0,'Fairfield- Pequot Library Association', eformatlabel)
worksheet.write(58,0,'Farmington', eformatlabel)
worksheet.write(59,0,'Franklin', eformatlabel)
worksheet.write(60,0,'Glastonbury -  East Glastonbury Public Library', eformatlabel)
worksheet.write(61,0,'Glastonbury -  South Glastonbury Public Library', eformatlabel)
worksheet.write(62,0,'Glastonbury- Welles-Turner Memorial Library', eformatlabel)
worksheet.write(63,0,'Goshen', eformatlabel)
worksheet.write(64,0,'Granby', eformatlabel)
worksheet.write(65,0,'Greenwich', eformatlabel)
worksheet.write(66,0,'Greenwich Perrot', eformatlabel)
worksheet.write(67,0,'Griswold', eformatlabel)
worksheet.write(68,0,'Groton- Bill Memorial Library', eformatlabel)
worksheet.write(69,0,'Groton- Groton Public Library', eformatlabel)
worksheet.write(70,0,'Groton- Mystic & Noank Library', eformatlabel)
worksheet.write(71,0,'Guilford', eformatlabel)
worksheet.write(72,0,'Haddam', eformatlabel)
worksheet.write(73,0,'Hamden', eformatlabel)
worksheet.write(74,0,'Hampton', eformatlabel)
worksheet.write(75,0,'Hartford', eformatlabel)
worksheet.write(76,0,'Hartland', eformatlabel)
worksheet.write(77,0,'Harwinton', eformatlabel)
worksheet.write(78,0,'Hebron', eformatlabel)
worksheet.write(79,0,'Kent', eformatlabel)
worksheet.write(80,0,'Killingly', eformatlabel)
worksheet.write(81,0,'Killingworth', eformatlabel)
worksheet.write(82,0,'Lebanon', eformatlabel)
worksheet.write(83,0,'Ledyard', eformatlabel)
worksheet.write(84,0,'Litchfield - Gilbert Library', eformatlabel)
worksheet.write(85,0,'Litchfield - Oliver Wolcott Library', eformatlabel)
worksheet.write(86,0,'Lyme', eformatlabel)
worksheet.write(87,0,'Madison', eformatlabel)
worksheet.write(88,0,'Manchester', eformatlabel)
worksheet.write(89,0,'Mansfield', eformatlabel)
worksheet.write(90,0,'Marlborough', eformatlabel)
worksheet.write(91,0,'Meriden', eformatlabel)
worksheet.write(92,0,'Middlebury', eformatlabel)
worksheet.write(93,0,'Middlefield', eformatlabel)
worksheet.write(94,0,'Middletown', eformatlabel)
worksheet.write(95,0,'Milford', eformatlabel)
worksheet.write(96,0,'Monroe', eformatlabel)
worksheet.write(97,0,'Montville', eformatlabel)
worksheet.write(98,0,'Morris', eformatlabel)
worksheet.write(99,0,'Naugatuck', eformatlabel)
worksheet.write(100,0,'New Britain', eformatlabel)
worksheet.write(101,0,'New Canaan', eformatlabel)
worksheet.write(102,0,'New Fairfield', eformatlabel)
worksheet.write(103,0,'New Hartford- Bakerville Library, Inc.', eformatlabel)
worksheet.write(104,0,'New Hartford- Licia & Mason Beekley Library', eformatlabel)
worksheet.write(105,0,'New Haven', eformatlabel)
worksheet.write(106,0,'New London', eformatlabel)
worksheet.write(107,0,'New Milford', eformatlabel)
worksheet.write(108,0,'Newington', eformatlabel)
worksheet.write(109,0,'Newtown', eformatlabel)
worksheet.write(110,0,'Norfolk', eformatlabel)
worksheet.write(111,0,'North Branford', eformatlabel)
worksheet.write(112,0,'North Canaan', eformatlabel)
worksheet.write(113,0,'North Haven', eformatlabel)
worksheet.write(114,0,'North Stonington', eformatlabel)
worksheet.write(115,0,'Norwalk- East Norwalk', eformatlabel)
worksheet.write(116,0,'Norwalk - Norwalk Public Library', eformatlabel)
worksheet.write(117,0,'Norwalk- Rowayton', eformatlabel)
worksheet.write(118,0,'Norwich', eformatlabel)
worksheet.write(119,0,'Old Lyme', eformatlabel)
worksheet.write(120,0,'Old Saybrook', eformatlabel)
worksheet.write(121,0,'Orange', eformatlabel)
worksheet.write(122,0,'Oxford', eformatlabel)
worksheet.write(123,0,'Plainfield', eformatlabel)
worksheet.write(124,0,'Plainville', eformatlabel)
worksheet.write(125,0,'Plymouth', eformatlabel)
worksheet.write(126,0,'Pomfret- Abington Social Library', eformatlabel)
worksheet.write(127,0,'Pomfret- Pomfret Public Library', eformatlabel)
worksheet.write(128,0,'Portland', eformatlabel)
worksheet.write(129,0,'Preston', eformatlabel)
worksheet.write(130,0,'Prospect', eformatlabel)
worksheet.write(131,0,'Putnam', eformatlabel)
worksheet.write(132,0,'Redding', eformatlabel)
worksheet.write(133,0,'Ridgefield', eformatlabel)
worksheet.write(134,0,'Rocky Hill', eformatlabel)
worksheet.write(135,0,'Roxbury', eformatlabel)
worksheet.write(136,0,'Salem', eformatlabel)
worksheet.write(137,0,'Salisbury', eformatlabel)
worksheet.write(138,0,'Scotland', eformatlabel)
worksheet.write(139,0,'Seymour', eformatlabel)
worksheet.write(140,0,'Sharon', eformatlabel)
worksheet.write(141,0,'Shelton', eformatlabel)
worksheet.write(142,0,'Sherman', eformatlabel)
worksheet.write(143,0,'Simsbury', eformatlabel)
worksheet.write(144,0,'Somers', eformatlabel)
worksheet.write(145,0,'South Windsor- South Windsor Public Library', eformatlabel)
worksheet.write(146,0,'South Windsor- Wood Memorial Library', eformatlabel)
worksheet.write(147,0,'Southbury', eformatlabel)
worksheet.write(148,0,'Southington', eformatlabel)
worksheet.write(149,0,'Sprague', eformatlabel)
worksheet.write(150,0,'Stafford', eformatlabel)
worksheet.write(151,0,'Stamford', eformatlabel)
worksheet.write(152,0,'Sterling', eformatlabel)
worksheet.write(153,0,'Stonington', eformatlabel)
worksheet.write(154,0,'Stratford', eformatlabel)
worksheet.write(155,0,'Suffield', eformatlabel)
worksheet.write(156,0,'Thomastan', eformatlabel)
worksheet.write(157,0,'Thompson', eformatlabel)
worksheet.write(158,0,'Tolland', eformatlabel)
worksheet.write(159,0,'Torrington', eformatlabel)
worksheet.write(160,0,'Trumbull', eformatlabel)
worksheet.write(161,0,'Union', eformatlabel)
worksheet.write(162,0,'Vernon', eformatlabel)
worksheet.write(163,0,'Voluntown', eformatlabel)
worksheet.write(164,0,'Wallingford', eformatlabel)
worksheet.write(165,0,'Warren', eformatlabel)
worksheet.write(166,0,'Washington', eformatlabel)
worksheet.write(167,0,'Waterbury', eformatlabel)
worksheet.write(168,0,'Waterford', eformatlabel)
worksheet.write(169,0,'Watertown', eformatlabel)
worksheet.write(170,0,'West Hartford', eformatlabel)
worksheet.write(171,0,'West Haven', eformatlabel)
worksheet.write(172,0,'Westbrook', eformatlabel)
worksheet.write(173,0,'Weston', eformatlabel)
worksheet.write(174,0,'Westport', eformatlabel)
worksheet.write(175,0,'Wethersfield', eformatlabel)
worksheet.write(176,0,'Willington', eformatlabel)
worksheet.write(177,0,'Wilton', eformatlabel)
worksheet.write(178,0,'Winchester', eformatlabel)
worksheet.write(179,0,'Windham - Guilford Smith Memorial, Inc.', eformatlabel)
worksheet.write(180,0,'Windham - Willmantic Public Library', eformatlabel)
worksheet.write(181,0,'Windham - Windham Free Library', eformatlabel)
worksheet.write(182,0,'Windsor', eformatlabel)
worksheet.write(183,0,'Windsor Locks', eformatlabel)
worksheet.write(184,0,'Wolcott', eformatlabel)
worksheet.write(185,0,'Woodbridge', eformatlabel)
worksheet.write(186,0,'Woodbury', eformatlabel)
worksheet.write(187,0,'Woodstock - Howard W. Bracken Library', eformatlabel)
worksheet.write(188,0,'Woodstock - May Memorial Library', eformatlabel)
worksheet.write(189,0,'Woodstock - North Woodstock', eformatlabel)
worksheet.write(190,0,'Woodstock - West Woodstock', eformatlabel)

for rownum, col in enumerate(rows):


    worksheet.write(rownum+1,1,col[0])
    worksheet.write(rownum+2,1,col[1])
    worksheet.write(rownum+3,1,col[2])
    worksheet.write(rownum+4,1,col[3])
    worksheet.write(rownum+5,1,col[4])
    worksheet.write(rownum+6,1,col[5])
    worksheet.write(rownum+7,1,col[6])
    worksheet.write(rownum+8,1,col[7])
    worksheet.write(rownum+9,1,col[8]) 
    worksheet.write(rownum+10,1,col[9]) 
    worksheet.write(rownum+11,1,col[10])
    worksheet.write(rownum+12,1,col[11]) 
    worksheet.write(rownum+13,1,col[12])     
    worksheet.write(rownum+14,1,col[13])    
    worksheet.write(rownum+15,1,col[14])
    worksheet.write(rownum+16,1,col[15])
    worksheet.write(rownum+17,1,col[16])
    worksheet.write(rownum+18,1,col[17])
    worksheet.write(rownum+19,1,col[18]) 
    worksheet.write(rownum+20,1,col[19]) 
    worksheet.write(rownum+21,1,col[20])
    worksheet.write(rownum+22,1,col[21])
    worksheet.write(rownum+23,1,col[22])
    worksheet.write(rownum+24,1,col[23])
    worksheet.write(rownum+25,1,col[24])
    worksheet.write(rownum+26,1,col[25])
    worksheet.write(rownum+27,1,col[26])
    worksheet.write(rownum+28,1,col[27])
    worksheet.write(rownum+29,1,col[28]) 
    worksheet.write(rownum+30,1,col[29]) 
    worksheet.write(rownum+31,1,col[30])
    worksheet.write(rownum+32,1,col[31])
    worksheet.write(rownum+33,1,col[32])
    worksheet.write(rownum+34,1,col[33])
    worksheet.write(rownum+35,1,col[34])
    worksheet.write(rownum+36,1,col[35])
    worksheet.write(rownum+37,1,col[36])
    worksheet.write(rownum+38,1,col[37])
    worksheet.write(rownum+39,1,col[38]) 
    worksheet.write(rownum+40,1,col[39])
    worksheet.write(rownum+41,1,col[40])
    worksheet.write(rownum+42,1,col[41])
    worksheet.write(rownum+43,1,col[42])
    worksheet.write(rownum+44,1,col[43])
    worksheet.write(rownum+45,1,col[44])
    worksheet.write(rownum+46,1,col[45])
    worksheet.write(rownum+47,1,col[46])
    worksheet.write(rownum+48,1,col[47])
    worksheet.write(rownum+49,1,col[48]) 
    worksheet.write(rownum+50,1,col[49])
    worksheet.write(rownum+51,1,col[50])
    worksheet.write(rownum+52,1,col[51])
    worksheet.write(rownum+53,1,col[52])
    worksheet.write(rownum+54,1,col[53])
    worksheet.write(rownum+55,1,col[54])
    worksheet.write(rownum+56,1,col[55])
    worksheet.write(rownum+57,1,col[56])
    worksheet.write(rownum+58,1,col[57])
    worksheet.write(rownum+59,1,col[58]) 
    worksheet.write(rownum+60,1,col[59])
    worksheet.write(rownum+61,1,col[60])
    worksheet.write(rownum+62,1,col[61])
    worksheet.write(rownum+63,1,col[62])
    worksheet.write(rownum+64,1,col[63])
    worksheet.write(rownum+65,1,col[64])
    worksheet.write(rownum+66,1,col[65])
    worksheet.write(rownum+67,1,col[66])
    worksheet.write(rownum+68,1,col[67])
    worksheet.write(rownum+69,1,col[68]) 
    worksheet.write(rownum+70,1,col[69]) 
    worksheet.write(rownum+71,1,col[70])
    worksheet.write(rownum+72,1,col[71])
    worksheet.write(rownum+73,1,col[72])
    worksheet.write(rownum+74,1,col[73])
    worksheet.write(rownum+75,1,col[74])
    worksheet.write(rownum+76,1,col[75])
    worksheet.write(rownum+77,1,col[76])
    worksheet.write(rownum+78,1,col[77])
    worksheet.write(rownum+79,1,col[78]) 
    worksheet.write(rownum+80,1,col[79]) 
    worksheet.write(rownum+81,1,col[80])
    worksheet.write(rownum+82,1,col[81])
    worksheet.write(rownum+83,1,col[82])
    worksheet.write(rownum+84,1,col[83])
    worksheet.write(rownum+85,1,col[84])
    worksheet.write(rownum+86,1,col[85])
    worksheet.write(rownum+87,1,col[86])
    worksheet.write(rownum+88,1,col[87])
    worksheet.write(rownum+89,1,col[88]) 
    worksheet.write(rownum+90,1,col[89]) 
    worksheet.write(rownum+91,1,col[90])
    worksheet.write(rownum+92,1,col[91])
    worksheet.write(rownum+93,1,col[92])
    worksheet.write(rownum+94,1,col[93])
    worksheet.write(rownum+95,1,col[94])
    worksheet.write(rownum+96,1,col[95])
    worksheet.write(rownum+97,1,col[96])
    worksheet.write(rownum+98,1,col[97])
    worksheet.write(rownum+99,1,col[98]) 
    worksheet.write(rownum+100,1,col[99]) 
    worksheet.write(rownum+101,1,col[100])
    worksheet.write(rownum+102,1,col[101])
    worksheet.write(rownum+103,1,col[102])
    worksheet.write(rownum+104,1,col[103])
    worksheet.write(rownum+105,1,col[104])
    worksheet.write(rownum+106,1,col[105])
    worksheet.write(rownum+107,1,col[106])
    worksheet.write(rownum+108,1,col[107])
    worksheet.write(rownum+109,1,col[108])
    worksheet.write(rownum+110,1,col[109])
    worksheet.write(rownum+111,1,col[110])
    worksheet.write(rownum+112,1,col[111])
    worksheet.write(rownum+113,1,col[112])
    worksheet.write(rownum+114,1,col[113])
    worksheet.write(rownum+115,1,col[114])
    worksheet.write(rownum+116,1,col[115])
    worksheet.write(rownum+117,1,col[116])
    worksheet.write(rownum+118,1,col[117])
    worksheet.write(rownum+119,1,col[118])
    worksheet.write(rownum+120,1,col[119])
    worksheet.write(rownum+121,1,col[120])
    worksheet.write(rownum+122,1,col[121])
    worksheet.write(rownum+123,1,col[122])
    worksheet.write(rownum+124,1,col[123])
    worksheet.write(rownum+125,1,col[124])
    worksheet.write(rownum+126,1,col[125])
    worksheet.write(rownum+127,1,col[126])
    worksheet.write(rownum+128,1,col[127])
    worksheet.write(rownum+129,1,col[128])
    worksheet.write(rownum+130,1,col[129])
    worksheet.write(rownum+131,1,col[130])
    worksheet.write(rownum+132,1,col[131])
    worksheet.write(rownum+133,1,col[132])
    worksheet.write(rownum+134,1,col[133])
    worksheet.write(rownum+135,1,col[134])
    worksheet.write(rownum+136,1,col[135])
    worksheet.write(rownum+137,1,col[136])
    worksheet.write(rownum+138,1,col[137])
    worksheet.write(rownum+139,1,col[138])
    worksheet.write(rownum+140,1,col[139])
    worksheet.write(rownum+141,1,col[140])
    worksheet.write(rownum+142,1,col[141])
    worksheet.write(rownum+143,1,col[142])
    worksheet.write(rownum+144,1,col[143])
    worksheet.write(rownum+145,1,col[144])
    worksheet.write(rownum+146,1,col[145])
    worksheet.write(rownum+147,1,col[146])
    worksheet.write(rownum+148,1,col[147])
    worksheet.write(rownum+149,1,col[148])
    worksheet.write(rownum+150,1,col[149])
    worksheet.write(rownum+151,1,col[150])
    worksheet.write(rownum+152,1,col[151])
    worksheet.write(rownum+153,1,col[152])
    worksheet.write(rownum+154,1,col[153])
    worksheet.write(rownum+155,1,col[154])
    worksheet.write(rownum+156,1,col[155])
    worksheet.write(rownum+157,1,col[156])
    worksheet.write(rownum+158,1,col[157])
    worksheet.write(rownum+159,1,col[158])
    worksheet.write(rownum+160,1,col[159])
    worksheet.write(rownum+161,1,col[160])
    worksheet.write(rownum+162,1,col[161])
    worksheet.write(rownum+163,1,col[162])
    worksheet.write(rownum+164,1,col[163])
    worksheet.write(rownum+165,1,col[164])
    worksheet.write(rownum+166,1,col[165])
    worksheet.write(rownum+167,1,col[166])
    worksheet.write(rownum+168,1,col[167])
    worksheet.write(rownum+169,1,col[168])
    worksheet.write(rownum+170,1,col[169])
    worksheet.write(rownum+171,1,col[170])
    worksheet.write(rownum+172,1,col[171])
    worksheet.write(rownum+173,1,col[172])
    worksheet.write(rownum+174,1,col[173])
    worksheet.write(rownum+175,1,col[174])
    worksheet.write(rownum+176,1,col[175])
    worksheet.write(rownum+177,1,col[176])
    worksheet.write(rownum+178,1,col[177])
    worksheet.write(rownum+179,1,col[178])
    worksheet.write(rownum+180,1,col[179])
    worksheet.write(rownum+181,1,col[180])
    worksheet.write(rownum+182,1,col[181])
    worksheet.write(rownum+183,1,col[182])
    worksheet.write(rownum+184,1,col[183])
    worksheet.write(rownum+185,1,col[184])
    worksheet.write(rownum+186,1,col[185])
    worksheet.write(rownum+187,1,col[186])
    worksheet.write(rownum+188,1,col[187]) 
    worksheet.write(rownum+189,1,col[188]) 
    worksheet.write(rownum+190,1,col[189])



workbook.close()


#Creating the email message
msg = MIMEMultipart()
msg['From'] = emailfrom
if type(emailto) is list:
    msg['To'] = ','.join(emailto)
else:
    msg['To'] = emailto
msg['Date'] = formatdate(localtime = True)
msg['Subject'] = emailsubject
msg.attach (MIMEText(emailmessage))
part = MIMEBase('application', "octet-stream")
part.set_payload(open(excelfile,"rb").read())
encoders.encode_base64(part)
part.add_header('Content-Disposition','attachment; filename=%s' % excelfile)
msg.attach(part)

#Sending the email message
smtp = smtplib.SMTP(emailhost, emailport)
smtp.sendmail(emailfrom, emailto, msg.as_string())
smtp.quit()








